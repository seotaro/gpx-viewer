(this["webpackJsonpgpx-viewer"]=this["webpackJsonpgpx-viewer"]||[]).push([[0],{210:function(e,t){},298:function(e,t,n){},313:function(e,t){},315:function(e,t){},333:function(e,t){},337:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(38),o=n.n(i),c=(n(298),n(86)),s=n(53),l=n(205),u=n(206),d=n(67),m=n.n(d),p=n(117),f=n(17),b=n(401),h=n(405),j=n(408),g=n(406),O=n(265),w=n(400),x=n(65),v=n(120),k=n(394),y=n(207),N=n(255),S=n.n(N),C=n(173),F=n.n(C);function P(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.readAsText(e)}))}function G(e){for(var t=[],n=0;n<e.length;n++)for(var a=e[n],r=a.points,i=1;i<r.length;i++){var o=r[i-1],c=r[i];t.push({segmentId:a.id,from:[o.lon,o.lat],to:[c.lon,c.lat],ele:c.ele,time:c.time})}return t}var z=n(47),E={longitude:138,latitude:37,zoom:5,minZoom:4,maxZoom:16},H=[{field:"id",headerName:"No.",valueFormatter:function(e){return e.value+1},width:60,sortable:!1},{field:"start",headerName:"start",valueFormatter:function(e){var t=e.value;return F()(t).format()},width:220},{field:"end",headerName:"end",valueFormatter:function(e){var t=e.value;return F()(t).format()},width:220},{field:"count",headerName:"count",type:"number",width:80,sortable:!1}],I=[{field:"id",headerName:"No.",valueFormatter:function(e){return e.value+1},width:60,sortable:!1},{field:"time",headerName:"time",valueFormatter:function(e){var t=e.value;return F()(t).format()},width:220},{field:"lat",headerName:"lat [deg]",type:"number",width:100,sortable:!1},{field:"lon",headerName:"lon [deg]",type:"number",width:100,sortable:!1},{field:"ele",headerName:"ele [m]",type:"number",width:80,sortable:!1}],M={marker:{x:0,y:0,width:48,height:48,anchorX:24,anchorY:48,mask:!0}},R=Object(x.a)((function(e){return{root:{width:"100vw",height:"100vh"},listGrid:{},mapGrid:{position:"relative"},segmentsGrid:{padding:10,height:"40%"},pointsGrid:{padding:10,height:"50%"},controllerGrid:{padding:10,height:"5%"},button:{margin:5,backgroundColor:"lightgray"}}}));var D=function(){var e,t=Object(a.useState)(null),n=Object(f.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)([]),d=Object(f.a)(o,2),x=d[0],N=d[1],C=Object(a.useState)([]),F=Object(f.a)(C,2),D=F[0],T=F[1],Z=Object(a.useState)(null),A=Object(f.a)(Z,2),L=A[0],_=A[1],B=Object(a.useState)(null),J=Object(f.a)(B,2),U=J[0],W=J[1],V=Object(a.useState)(null),X=Object(f.a)(V,2),Y=X[0],q=X[1],K=Object(a.useState)(null),Q=Object(f.a)(K,2),$=Q[0],ee=Q[1],te=R();Object(a.useEffect)((function(){Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r?(N(r.track.segments),T([]),q(G(r.track.segments))):(N([]),T([]),q(null),ee(null));case 1:case"end":return e.stop()}}),e)})))()}),[r]),Object(a.useEffect)((function(){Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_(null);case 1:case"end":return e.stop()}}),e)})))()}),[x]),Object(a.useEffect)((function(){Object(p.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&(0===L||0<L)?(t=r.track.segments,n=t[L],T(n.points.map((function(e,t){return Object(u.a)({id:t},e)}))),q(G(r.track.segments))):(T([]),q(null),ee(null));case 1:case"end":return e.stop()}}),e)})))()}),[L]),Object(a.useEffect)((function(){Object(p.a)(m.a.mark((function e(){var t,n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&(0===L||0<L)&&(0===U||0<U)?(t=r.track.segments,n=t[L],a=n.points[U],ee([{coordinates:[a.lon,a.lat]}])):ee(null);case 1:case"end":return e.stop()}}),e)})))()}),[U]);var ne=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,a,r,o,c,d,p;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,e.next=3,Promise.all(Object.keys(n.files).map((function(e){return P(n.files[e]).then((function(e){return S.a.parseStringPromise(e,{mergeAttrs:!0})})).then((function(e){var t,n=[],a=Object(l.a)(e.gpx.trk);try{for(a.s();!(t=a.n()).done;){var r=t.value;n.push.apply(n,Object(s.a)(r.trkseg.map((function(e,t){return{start:new Date(e.trkpt[0].time),end:new Date(e.trkpt[e.trkpt.length-1].time),count:e.trkpt.length,points:e.trkpt.map((function(e){return{lat:Number(e.lat[0]),lon:Number(e.lon[0]),ele:Number(e.ele[0]),time:new Date(e.time[0])}}))}}))))}}catch(i){a.e(i)}finally{a.f()}return{segments:n.map((function(e,t){return Object(u.a)({id:t},e)}))}}))}))).catch((function(e){console.error(e)}));case 3:a=e.sent,r={track:{segments:[]}},o=Object(l.a)(a);try{for(o.s();!(c=o.n()).done;)p=c.value,(d=r.track.segments).push.apply(d,Object(s.a)(p.segments))}catch(m){o.e(m)}finally{o.f()}i(r),t.target.value=null;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i(null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(z.jsxs)(k.a,{container:!0,className:te.root,spacing:2,children:[Object(z.jsxs)(k.a,{container:!0,item:!0,xs:5,className:te.listGrid,children:[Object(z.jsxs)(k.a,{item:!0,xs:12,className:te.segmentsGrid,children:["segments",Object(z.jsx)(y.a,{rows:x,columns:H,disableColumnMenu:!0,headerHeight:30,rowHeight:30,hideFooterSelectedRowCount:!0,onRowClick:function(e,t){_(e.row.id)}})]}),Object(z.jsxs)(k.a,{item:!0,xs:12,className:te.pointsGrid,children:["points",Object(z.jsx)(y.a,{rows:D,columns:I,disableColumnMenu:!0,headerHeight:30,rowHeight:30,hideFooterSelectedRowCount:!0,rowsPerPageOptions:[100,500,1e3],onRowClick:function(e,t){W(e.row.id)}})]}),Object(z.jsxs)(k.a,{item:!0,xs:12,className:te.controllerGrid,children:[Object(z.jsx)("input",{multiple:!0,accept:"application/gpx+xml",id:"open-gpx-file",type:"file",hidden:!0,onChange:ne}),Object(z.jsx)("label",{htmlFor:"open-gpx-file",children:Object(z.jsx)(v.a,{component:"span",className:te.button,children:"open"})}),Object(z.jsx)(v.a,{component:"span",className:te.button,disabled:!r,onClick:ae,children:"clear"}),Object(z.jsx)(v.a,{component:"span",className:te.button,disabled:!0,children:"upload"})]})]}),Object(z.jsx)(k.a,{item:!0,xs:7,className:te.mapGrid,children:Object(z.jsxs)(b.a,{initialViewState:E,controller:!0,getCursor:function(e){return e.isHovering?"pointer":"grab"},children:[Object(z.jsx)(w.a,{id:"raster",data:"https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png",minZoom:5,maxZoom:18,tileSize:256,opacity:1,renderSubLayers:function(e){var t=e.tile.bbox,n=t.west,a=t.south,r=t.east,i=t.north;return new h.a(e,{data:null,image:e.data,bounds:[n,a,r,i]})}}),Object(z.jsx)(j.a,(e={id:"line-layer",data:Y,pickable:!0,widthUnits:"pixels",widthScale:4,getWidth:2,getSourcePosition:function(e){return e.from},getTargetPosition:function(e){return e.to}},Object(c.a)(e,"getWidth",1),Object(c.a)(e,"getColor",(function(e){return e.segmentId===L?[255,0,0]:[255,127,127]})),e)),Object(z.jsx)(g.a,{id:"icon-layer",data:$,iconAtlas:"baseline_place_black_48dp.png",iconMapping:M,getIcon:function(e){return"marker"},getPosition:function(e){return e.coordinates},sizeUnits:"pixels",sizeMinPixels:48,getColor:function(e){return[255,0,0]}}),Object(z.jsx)(O.a,{id:"map",controller:!0,repeat:!0})]})})]})},T=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,410)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};o.a.render(Object(z.jsx)(r.a.StrictMode,{children:Object(z.jsx)(D,{})}),document.getElementById("root")),T()}},[[337,1,2]]]);