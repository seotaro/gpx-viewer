(this["webpackJsonpgpx-viewer"]=this["webpackJsonpgpx-viewer"]||[]).push([[0],{210:function(e,t){},297:function(e,t,n){},312:function(e,t){},314:function(e,t){},332:function(e,t){},336:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(38),o=n.n(i),c=(n(297),n(86)),s=n(53),u=n(205),l=n(206),d=n(78),m=n.n(d),p=n(135),f=n(17),h=n(400),b=n(404),g=n(406),j=n(265),O=n(401),v=n(65),w=n(119),x=n(394),k=n(207),N=n(255),y=n.n(N),S=n(172),C=n.n(S);function F(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.readAsText(e)}))}function G(e){for(var t=[],n=0;n<e.length;n++)for(var a=e[n],r=a.points,i=1;i<r.length;i++){var o=r[i-1],c=r[i];t.push({segmentId:a.id,from:[o.lon,o.lat],to:[c.lon,c.lat],ele:c.ele,time:c.time})}return t}var P=n(48),H={longitude:138,latitude:37,zoom:5,minZoom:4,maxZoom:16},z=[{field:"id",headerName:"No.",valueFormatter:function(e){return e.value+1},width:60,sortable:!1},{field:"start",headerName:"start",valueFormatter:function(e){var t=e.value;return C()(t).format()},width:220},{field:"end",headerName:"end",valueFormatter:function(e){var t=e.value;return C()(t).format()},width:220},{field:"count",headerName:"count",type:"number",width:80,sortable:!1}],D=[{field:"id",headerName:"No.",valueFormatter:function(e){return e.value+1},width:60,sortable:!1},{field:"time",headerName:"time",valueFormatter:function(e){var t=e.value;return C()(t).format()},width:220},{field:"lat",headerName:"lat [deg]",type:"number",width:100,sortable:!1},{field:"lon",headerName:"lon [deg]",type:"number",width:100,sortable:!1},{field:"ele",headerName:"ele [m]",type:"number",width:80,sortable:!1}],E=Object(v.a)((function(e){return{root:{width:"100vw",height:"100vh"},listGrid:{},mapGrid:{position:"relative"},segmentsGrid:{padding:10,height:"40%"},pointsGrid:{padding:10,height:"50%"},controllerGrid:{padding:10,height:"5%"},button:{margin:5,backgroundColor:"lightgray"}}}));var I=function(){var e,t=Object(a.useState)(null),n=Object(f.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)([]),d=Object(f.a)(o,2),v=d[0],N=d[1],S=Object(a.useState)([]),C=Object(f.a)(S,2),I=C[0],R=C[1],T=Object(a.useState)(null),Z=Object(f.a)(T,2),L=Z[0],M=Z[1],A=Object(a.useState)(null),B=Object(f.a)(A,2),J=B[0],W=B[1],U=E();Object(a.useEffect)((function(){Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r?(N(r.track.segments),R([]),W(G(r.track.segments))):(N([]),R([]),W(null));case 1:case"end":return e.stop()}}),e)})))()}),[r]),Object(a.useEffect)((function(){Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M(null);case 1:case"end":return e.stop()}}),e)})))()}),[v]),Object(a.useEffect)((function(){Object(p.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&(0===L||0<L)?(t=r.track.segments,n=t[L],R(n.points.map((function(e,t){return Object(l.a)({id:t},e)}))),W(G(r.track.segments))):R([]);case 1:case"end":return e.stop()}}),e)})))()}),[L]);var V=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,a,r,o,c,d,p;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,e.next=3,Promise.all(Object.keys(n.files).map((function(e){return F(n.files[e]).then((function(e){return y.a.parseStringPromise(e,{mergeAttrs:!0})})).then((function(e){var t,n=[],a=Object(u.a)(e.gpx.trk);try{for(a.s();!(t=a.n()).done;){var r=t.value;n.push.apply(n,Object(s.a)(r.trkseg.map((function(e,t){return{start:new Date(e.trkpt[0].time),end:new Date(e.trkpt[e.trkpt.length-1].time),count:e.trkpt.length,points:e.trkpt.map((function(e){return{lat:Number(e.lat[0]),lon:Number(e.lon[0]),ele:Number(e.ele[0]),time:new Date(e.time[0])}}))}}))))}}catch(i){a.e(i)}finally{a.f()}return{segments:n.map((function(e,t){return Object(l.a)({id:t},e)}))}}))}))).catch((function(e){console.error(e)}));case 3:a=e.sent,r={track:{segments:[]}},o=Object(u.a)(a);try{for(o.s();!(c=o.n()).done;)p=c.value,(d=r.track.segments).push.apply(d,Object(s.a)(p.segments))}catch(m){o.e(m)}finally{o.f()}i(r),t.target.value=null;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i(null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(P.jsxs)(x.a,{container:!0,className:U.root,spacing:2,children:[Object(P.jsxs)(x.a,{container:!0,item:!0,xs:5,className:U.listGrid,children:[Object(P.jsxs)(x.a,{item:!0,xs:12,className:U.segmentsGrid,children:["segments",Object(P.jsx)(k.a,{rows:v,columns:z,disableColumnMenu:!0,headerHeight:30,rowHeight:30,hideFooterSelectedRowCount:!0,onRowClick:function(e,t){M(e.row.id)}})]}),Object(P.jsxs)(x.a,{item:!0,xs:12,className:U.pointsGrid,children:["points",Object(P.jsx)(k.a,{rows:I,columns:D,disableColumnMenu:!0,headerHeight:30,rowHeight:30,hideFooterSelectedRowCount:!0,rowsPerPageOptions:[100,500,1e3]})]}),Object(P.jsxs)(x.a,{item:!0,xs:12,className:U.controllerGrid,children:[Object(P.jsx)("input",{multiple:!0,accept:"application/gpx+xml",id:"open-gpx-file",type:"file",hidden:!0,onChange:V}),Object(P.jsx)("label",{htmlFor:"open-gpx-file",children:Object(P.jsx)(w.a,{component:"span",className:U.button,children:"open"})}),Object(P.jsx)(w.a,{component:"span",className:U.button,disabled:!r,onClick:q,children:"clear"}),Object(P.jsx)(w.a,{component:"span",className:U.button,disabled:!0,children:"upload"})]})]}),Object(P.jsx)(x.a,{item:!0,xs:7,className:U.mapGrid,children:Object(P.jsxs)(h.a,{initialViewState:H,controller:!0,getCursor:function(e){return e.isHovering?"pointer":"grab"},children:[Object(P.jsx)(O.a,{id:"raster",data:"https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png",minZoom:5,maxZoom:18,tileSize:256,opacity:1,renderSubLayers:function(e){var t=e.tile.bbox,n=t.west,a=t.south,r=t.east,i=t.north;return new b.a(e,{data:null,image:e.data,bounds:[n,a,r,i]})}}),Object(P.jsx)(g.a,(e={id:"line-layer",data:J,pickable:!0,widthUnits:"pixels",widthScale:4,getWidth:2,getSourcePosition:function(e){return e.from},getTargetPosition:function(e){return e.to}},Object(c.a)(e,"getWidth",1),Object(c.a)(e,"getColor",(function(e){return e.segmentId===L?[255,0,0]:[255,127,127]})),e)),Object(P.jsx)(j.a,{id:"map",controller:!0,repeat:!0})]})})]})},R=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,408)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};o.a.render(Object(P.jsx)(r.a.StrictMode,{children:Object(P.jsx)(I,{})}),document.getElementById("root")),R()}},[[336,1,2]]]);